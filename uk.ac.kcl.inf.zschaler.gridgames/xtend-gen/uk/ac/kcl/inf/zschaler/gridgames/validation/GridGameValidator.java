/**
 * generated by Xtext
 */
package uk.ac.kcl.inf.zschaler.gridgames.validation;

import com.google.common.base.Objects;
import org.eclipse.emf.ecore.EObject;
import org.eclipse.xtext.validation.Check;
import org.eclipse.xtext.xbase.lib.Functions.Function1;
import org.eclipse.xtext.xbase.lib.IterableExtensions;
import org.eclipse.xtext.xbase.lib.IteratorExtensions;
import uk.ac.kcl.inf.zschaler.gridgames.gridGame.CellState;
import uk.ac.kcl.inf.zschaler.gridgames.gridGame.ContextTrigger;
import uk.ac.kcl.inf.zschaler.gridgames.gridGame.GenerationalContexts;
import uk.ac.kcl.inf.zschaler.gridgames.gridGame.GridGamePackage;
import uk.ac.kcl.inf.zschaler.gridgames.gridGame.TransitionSpec;
import uk.ac.kcl.inf.zschaler.gridgames.gridGame.TransitionTriggerSpec;
import uk.ac.kcl.inf.zschaler.gridgames.validation.AbstractGridGameValidator;

/**
 * This class contains custom validation rules.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
@SuppressWarnings("all")
public class GridGameValidator extends AbstractGridGameValidator {
  @Check
  public void checkRecursiveContextTriggers(final TransitionSpec ts) {
    final Function1<EObject, Boolean> _function = new Function1<EObject, Boolean>() {
      @Override
      public Boolean apply(final EObject o) {
        return Boolean.valueOf((o instanceof GenerationalContexts));
      }
    };
    boolean _exists = IteratorExtensions.<EObject>exists(ts.eResource().getAllContents(), _function);
    boolean _not = (!_exists);
    if (_not) {
      TransitionTriggerSpec _trigger = ts.getTrigger();
      if ((_trigger instanceof ContextTrigger)) {
        final Function1<TransitionSpec, Boolean> _function_1 = new Function1<TransitionSpec, Boolean>() {
          @Override
          public Boolean apply(final TransitionSpec t) {
            return Boolean.valueOf(((t.getTrigger() instanceof ContextTrigger) && Objects.equal(t.getTarget(), ((CellState) ts.eContainer()))));
          }
        };
        boolean _exists_1 = IterableExtensions.<TransitionSpec>exists(ts.getTarget().getTransitions(), _function_1);
        if (_exists_1) {
          this.warning("You may need to check for potential recursive context triggers.", 
            GridGamePackage.Literals.TRANSITION_SPEC__TRIGGER, "recursiveContextTrigger");
        }
      }
    }
  }
}
